generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
}

model StockItem {
  id              String   @id @default(cuid())
  myobNumber      String
  model           String
  partName        String
  partNumber      String
  revision        String
  poNumber        String
  receivedQty     Int
  receivedDate    DateTime
  supplier        String?
  customer        String?
  issuedQty       Int?
  invoiceNumber   String?
  issueDate       DateTime?
  dueDate         DateTime?
  event           String?
  withdrawalNumber String? // เลขใบเบิก
  remarks         String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  transactions    Transaction[]
}

model Transaction {
  id            String      @id @default(cuid())
  stockItemId   String
  type          String      // 'RECEIVE', 'ISSUE', or 'NG'
  quantity      Int
  invoiceNumber String?
  transactionDate DateTime
  dueDate       DateTime?
  remarks       String?
  createdAt     DateTime    @default(now())
  
  // Relations
  stockItem     StockItem   @relation(fields: [stockItemId], references: [id], onDelete: Cascade)
}

model NGItem {
  id              String   @id @default(cuid())
  myobNumber      String
  model           String
  partName        String
  partNumber      String
  revision        String?
  poNumber        String?
  receivedDate    DateTime
  supplier        String?
  issuedQty       Int
  invoiceNumber   String?
  issueDate       DateTime
  customer        String?
  event           String?
  withdrawalNumber String?
  ngProblem       String?
  remarks         String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model DueRecord {
  id                 String   @id @default(cuid())
  dedupeKey          String   @unique @map("dedupe_key")
  deliveryType       String   @map("delivery_type")
  myobNumber         String   @map("myob_number")
  productRequestNo   String   @default("") @map("product_request_no")
  customer           String
  countryOfOrigin    String   @map("country_of_origin")
  sampleRequestSheet String   @map("sample_request_sheet")
  model              String
  partNumber         String   @map("part_number")
  partName           String   @map("part_name")
  revisionLevel      String   @map("revision_level")
  revisionNumber     String   @map("revision_number")
  event              String
  supplier           String   @default("")
  issuePrDate        String   @default("") @map("issue_pr_date")
  customerPo         String   @map("customer_po")
  prPo               String   @default("") @map("pr_po")
  purchase           String   @default("")
  invoiceIn          String   @default("") @map("invoice_in")
  invoiceOut         String   @default("") @map("invoice_out")
  withdrawalNumber   String   @default("") @map("withdrawal_number")
  quantity           Int
  dueDate            String   @map("due_date")
  dueSupplierToCustomer String @default("") @map("due_supplier_to_customer")
  dueSupplierToRk     String  @default("") @map("due_supplier_to_rk")
  dueRkToCustomer     String  @default("") @map("due_rk_to_customer")
  isDelivered        Boolean  @default(false) @map("is_delivered")
  deliveredAt        DateTime? @map("delivered_at")
  createdAt          DateTime @default(now()) @map("created_at")
  updatedAt          DateTime @updatedAt @map("updated_at")

  @@map("due_records")
}

model CustomButton {
  id          String   @id @default(cuid())
  name        String
  color       String   @default("blue")
  description String   @default("")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  buttonData  CustomButtonData[]

  @@map("custom_buttons")
}

model CustomButtonData {
  id         String   @id @default(cuid())
  buttonId   String
  fieldName  String   @map("field_name")
  fieldValue String   @map("field_value")
  fieldType  String   @default("text") @map("field_type")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  // Relations
  button     CustomButton @relation(fields: [buttonId], references: [id], onDelete: Cascade)

  @@map("custom_button_data")
}
